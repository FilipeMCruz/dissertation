\chapter{Performance Tests Analysis}
\label{AppendixG}

\begin{lstlisting}[style=Java,basicstyle=\tiny, caption=Analysis Script, label={code:AppendixG:script}]
## Import Libraries

prepare <- function(path) {
  data <- read.csv(path)
  data <- data[data$metric_name == 'time_lapse',]
  data <- data[c('timestamp', 'metric_value', 'extra_tags')]
  data$received <- data$timestamp - min(data$timestamp)
  data$metric_value <- data$metric_value / 1000
  data$sent_timestamp <- data$timestamp - data$metric_value
  data$sent <- data$sent_timestamp - min(data$sent_timestamp)
  data$iteration <- str_replace(data$extra_tags,'iteration=' ,'')
  return(data)
}

create <- function(dataframe, xParam) {
  ggplot(data=dataframe, mapping=aes(x=.data[[xParam]], y=metric_value, col=iteration, label="")) + 
    geom_point(alpha = 1, stat = "unique") +
    theme(legend.position = c(.9, .45)) +
    xlab(paste("time data unit was", xParam, "(seconds)")) +
    ylab("time taken to process data unit (seconds)")
}

outputTex <- function(pdot, path, xParam) {
  tikz(file = path, width = 5, height = 3.3)
  print(pdot)
  dev.off()
}

process <- function(path) {
  data <- prepare(paste(path,'data.csv', sep = "/"))
  pdot_sent <- create(data, "sent")
  pdot_received <- create(data, "received")
  outputTex(pdot_sent, paste(path, 'data_sent.tex', sep="/"))
  outputTex(pdot_received, paste(path, 'data_received.tex', sep="/"))
}

processScenario <- function(path) {
  scenario <- list.dirs(path)
  scenario <- scenario[-1]
  for (i in scenario) {
    process(i)
  }
}

processAll <- function() {
  processScenario('scenario1')
  processScenario('scenario2')
  processScenario('scenario3')
}

setwd("/home/user/iot-project/project/k6/results")

processAll()
\end{lstlisting}
